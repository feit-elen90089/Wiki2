# Measurements

When designing, implementing, and verifying real-world communication systems,
there are numerous helpful measurements that can be taken. This page explains
some of these measurements and details how they can be taken using the Keysight
FieldFox RF Analyzer.

## Contents

1. [Keysight FieldFox](#keysight-fieldfox)
2. [Spectrum Analyzer](#spectrum-analyzer)
3. [Oscilloscope](#oscilloscope)
4. [Frequency Offset](#frequency-offset)
5. [Transmit Power](#transmit-power)
6. [Occupied Bandwidth](#occupied-bandwidth)
7. [DC Offset](#dc-offset)
8. [IQ Imbalance](#iq-imbalance)

## Keysight FieldFox

The Keysight FieldFox RF Analyzer is a convenient tool for making a number of
usesful measurements on digital communication systems. Its small size,
ruggedized form, and battery make it ideal for portable applications, although
the FieldFoxes will be limited to desktop usage for ELEN90089. The FieldFox can
be used in one of three modes:

- Cable and Antenna Analyzer (CAT) - typically used to to test an entire
transmission system, from transmitter to the antenna. Similar to VNA mode.
- Vector Network Analyzer (VNA) - used to characterize two-port RF devices by
measuring both amplitude and phase responses to an applied stimulus.
- Spectrum Analyzer (SA) - used to observe and measure the characteristics of
a signal generated by some device or occurring over-the-air.

In ELEN90089 we will use the FieldFox almost exclusively in spectrum analyzer
mode. The following are detailed references on the performance characteristics
and measurement setup for the FieldFox:

- [Keysight FieldFox N9914A Datasheet](datasheets/5990-9783.pdf)
- [Keysight FieldFox N9914A User's Guide (Abridged)](datasheets/N9927-90001.pdf)

> **Note:** It is important to note the accuracy of a given measurement made
> with the FieldFox will be limited by its relevant performance specifications.
> See the [datasheet](datasheets/5990-9783.pdf) for full performance
> specifications.

## Spectrum Analyzer

Using the FieldFox as a basic spectrum analyzer is straightforward. Either
attach an antenna or cable your transmitted signal into the *RF IN* port of
the analyzer. An SMA to N-type adaptor should be present on all FieldFoxes in
the lab. The FieldFox can be put into spectrum analyzer mode be selecting:
`Mode > SA`.

At a minimum, to observe the frequency spectrum of a signal at RF you should set
the following parameters:

- Center Frequency: `Freq/Dist > Center`
- Bandwith: `Freq/Dist > Freq Span`

The FieldFox will likely set the amplitude (Y-axis) scale automatically, but you
may wish to adjust this to better investigate the signal of interest:

- To use autoscale: `Scale/Amptd > More > Autoscale`
- To set the units per division (gridlines): `Scale/Amptd > Scale`
- To set the reference level (top of graph): `Scale/Amptd > Ref Level`

Markers can be used to investigate specific points on the output spectrum. For
example, to find the frequency and power of the highest peak displayed you can
choose: `Marker > Peak`.

Refer to the [user's guide](datasheets/N9927-90001.pdf) for full details on
configuring the FieldFox.

## Oscilloscope

The FieldFox can be used as an oscilloscope by setting the frequency span to
zero: `Freq > Freq Span`. You can then:

- Set the center frequency as desired: `Freq/Dist > Center`
- Set the sweep time to change the length of the time plot:
`Sweep 3 > Sweep Time`
- Set the resolution bandwidth (ResBW) to change the captured bandwidth:
`BW 2 > ResBW > Man`

## Frequency Offset

The frequency offset of a device (e.g., the bladeRF) can be measured by
configuring the device to generate a tone at a known frequency and then using
the marker function to observe the location on the FieldFox display. Frequency
offset is then the difference between these two values.

> **Note:** The accuracy of frequency measurements are limited by the accuracy
> of the LO used in the FieldFox, which is +/- 0.7 ppm + aging. See the
> [datasheet](datasheets/5990-9783.pdf) for full performance specifications.

## Transmit Power

Any external attenuator used (e.g., the 30 dB SMA attenuator we use for hardware
loopback) should be accounted for in power measurements. This can be done
automatically in the value displayed by the FieldFox by setting
`Scale/Ampltd > More > External Gain`.

The power level of a single frequency tone is best measured using a marker:
`Marker > Peak`.

For signals with non-zero bandwidth, e.g., a modulated signal, the channel
power (CHP) within a frequency range should be measured using:
`Measure 1 > Channel Measurements > Channel Power`.

- To set the integrated bandwidth used in the CHP measurement:
`Meas Setup 4 > Integrating BW`

> **Note:** Power measurements with the FieldFox generally have an accuracy of
> +/- 1 dBm. See the [datasheet](datasheets/5990-9783.pdf) for full performance
> specifications.

## Occupied Bandwidth

The occupied bandwidth measurement looks over a frequency span and determines
the start and stop frequencies between which is contained a specific percentage
of the observed power, e.g., 95% of the observed power. These frequencies are
marked with vertical bars and both occupied bandwidth and occupied power
measurements are displayed. To measure occupied bandwidth:

- `Measure 1 > Channel Measurements > Occupied Bandwidth`

## DC Offset

The RF front-ends of the SDRs we employ in ELEN90089 all employ direct
conversion architectures (zero IF or homodyne) for both their transmit and
receive chains. Direct conversion greatly reduces the number of components in
the RF front-end and simplifies the design, but results in a number of specific
impairments that need to be addressed. DC offset, partially as a result of LO
leakage, is one such impairment.

DC offset of a transmitter can be observed by configuring the device to
generate a signal with no energy component at dc and then observing the output
on a spectrum analyzer. As an example, we can generate a complex exponential
rotating at a frequency f_0 at baseband, which after upconversion by our RF
front-end should be present f_0 Hz above our carrier frequency (f_c + f_0).
The ratio between the power at our desired frequency (f_c + f_0) and that at
the carrier (f_c) is a quantification of the severity of the DC offset
present. This is typically expressed in units of dBs below carrier (dBc).

```
P_dc (dBc) = P_{f_c + f_0} (dBm) - P_{f_c} (dBm)
```

Larger values of `P_dc` are obviously better. DC offset of a receiver can be
measured in a similar way by feeding a passband signal with no energy at the
carrier frequency (f_c) into the RF front-end downconverter and observing the
resulting baseband spectrum. Care must be taken that the DC offset of the device
generating the waveform is negligible so as not to distort the measurement.

> **Important Note:** DC offset is both gain and frequency dependent.

## IQ Imbalance

IQ imbalance is the other main impairment of direct conversion receivers that we
discussed. It is the result of a mismatch in the gains and phases of the
in-phase and quadrature LOs generated for use in up- or downconversion. It is
present in all architectures that use quadrature modulation or demodulation,
but is more pronounced in direct conversion architectures.

IQ imbalance of a transmitter can also be measured by generating a tone at a
known frequency offset (f_0) from the carrier (f_c) and observing the output
spectrum. When present, in addition to the desired tone at f_c + f_0 (Hz), IQ
imbalance results in a complementary tone at the same offset below the carrier,
f_c - f_0 (Hz). The ratio between the power of these two tones is a measure of
the severity of the IQ imbalance.

```
P_{iq} (dBc) = P_{f_c + f_0} (dBm) - P_{f_c - f_0} (dBm)
```

Receiver IQ imbalance can also be measured using the a single-tone test but,
again, care should be taken to ensure the measurement is not capturing any IQ
imbalance in the device generating the waveform.

> **Important Note:** IQ imbalance is both gain and frequency dependent.
